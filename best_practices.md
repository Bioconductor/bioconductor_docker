# Best practices and standards for Bioconductor Docker Images

This document aims to outline some of the policies we have set to
better maintain the Bioconductor Docker images and also community
contributions.

<a name="top"></a>

<!-- markdown-toc start - Don't edit this section. Run M-x markdown-toc-refresh-toc -->
**Table of Contents**

- [Best practices and standards for Bioconductor Docker Images](#best-practices-and-standards-for-bioconductor-docker-images)
    - [How to contribute](#how-to-contribute)
    - [Best Practices and Standards for a Docker image](#best-practices-and-standards-for-a-docker-image)
    - [Deprecation policy](#deprecation-policy)
        - [Criteria for Package deprecation](#criteria-for-package-deprecation)
        - [End of Life process](#end-of-life-process)
        - [Reversing End of Life](#reversing-end-of-life)
    - [Release Cycle and Support](#release-cycle-and-support)
    - [Acknowledgements](#acknowledgements)

<!-- markdown-toc end -->
## How to contribute

1. The Docker image should be on a GitHub repository owned by the
   author.

1. Once the image is ready to be submitted, submit the repository as
   an [issue](https://github.com/Bioconductor/Contributions/issues/)
   through contributions page. For more instructions on how to submit,
   https://github.com/Bioconductor/Contributions.

1. The first iteration of the contribution should be developed from
   the "devel" (master branch) branch of the base image i.e
   `bioconductor/bioconductor_docker:devel`.

1. Once accepted, the repository will be moved under the Bioconductor
   organization with full read/write access to the Github
   repository.

1. The Docker Hub organization for Bioconductor will be controlled by
   the Core team, and builds will be triggered through a push to the
   GitHub repository which the maintainer will have access to and a
   new tag for a branch will be added by the Core team at the time of
   release to enable builds on Docker Hub. We hope to automate some of
   this in the future.

1. The author should demonstrate, through Docker Hub builds before
   acceptance, that the image builds successfully. This guide on
   Docker Hub is very helpful,
   https://docs.docker.com/docker-hub/builds/link-source/.

1. The repository should have an open source license in the
   LICENSE.txt file. Core Bioconductor packages are typically licensed
   under Artistic-2.0.

1. At the time of RELEASE, `bioconductor/bioconductor_docker` will
   provide a new RELEASE_X_Y branch. The maintainers are expected to
   create a new branch in their repository with the tag
   `RELEASE_X_Y` and depend on the appropriate docker image of
   `bioconductor/bioconductor_docker:RELEASE_X_Y`. Once the branch
   is created, notify the team. You will have approximately 4 weeks to
   go through the creation of the release branch.
   
   The maintainers will be expected to branch from the current "devel"
   image a new RELEASE_X_Y branch.

<p class="back_to_top">[ <a href="#top">Back to top</a> ]</p>

## Best Practices and Standards for a Docker image

1. For every repository submitted the Dockerfile is in the top level
   directory.

1. Docker images should be based on the
   `bioconductor/bioconductor_docker` images, so that they can inherit
   all the installed packages and customization.

1. Images should have a Dockerfile which is clearly defined and
   documented.

1. Images should clean up extraneous files created as part of the
   installation process, to optimize the space used by the image
   layers. Please check https://www.fromlatest.io if you have any
   questions regarding how to optimize the Dockerfile.

1. The README.md file will act as the vignette for the images. The
   README.md should have a clear reasoning on *what* this Dockerfile
   provides, i.e additional tools or packages on top of
   bioconductor/bioconductor_docker. Remember there is very little
   value in providing the same image with a couple of extra
   packages on top of it as users can install these packages
   themselves.

1. Add metadata fields identifying the image in the Dockerfile like
   below,

		LABEL name="bioconductor/bioconductor_docker" \
			  version="devel" \
		      url="https://github.com/Bioconductor/bioconductor_docker" \
              maintainer="maintainer@bioconductor.org" \
              description="Bioconductor docker image with system dependencies to install all* packages." \
              license="Artistic 2.0"

	These Metadata fields allow the image to be identified by the
    user. 

1. Add build badges in your README.md file for the image. This can be
   easily generated by https://shields.io/category/build, like below

		[![Docker Build Status](https://img.shields.io/docker/cloud/build/bioconductor/bioconductor_docker.svg)](https://hub.docker.com/r/bioconductor/bioconductor_docker/builds/)

1. The `RELEASE_X_Y` image should be maintained without a build
   failure. Similar to the packages the RELEASE_X_Y images should not
   be an active development repository except for bug fixes.

<p class="back_to_top">[ <a href="#top">Back to top</a> ]</p>

## Deprecation policy

We expect Docker images to follow the same deprecation policy as
[Bioconductor packages](http://bioconductor.org/developers/package-end-of-life/).

###  Criteria for image deprecation

1. `docker build` fails.

	The image must build successfully at each Bioconductor release. All
    efforts will be made to keep the image in Bioconductor if the
    maintainer is actively attempting to fix.

	If an image is broken for an extended period of time the
    maintainer will be given a final 6 week notice. If the image is
    not fixed by the end of the 6 weeks, an 'End-of-Life' process will
    be started.

1. Inactive maintainer

   The maintainer listed in the Dockerfile under `LABEL
   maintainer="maintainer@email.com"` must be responsive to questions
   on the support site, image related emails from users, build
   failures on Docker Hub and Bioconductor team members. Broken
   images should be fixed in a timely manner.

   If you are unable to fix your image, please contact the Core team
   for help or for a time extension.

   Alternatively, an image maintainer may decide that they no longer
   wish to maintain their image.

### End of Life process

**Step 1**: Deprecation

The image will be marked with a "deprecation" warning. The README file
of the Github repository will be updated, along with the build badge.

If at any time in this 6 month period the required criteria are met
(e.g., the package returns to active maintenance, perhaps after
‘adoption’ by a third party) the warning is removed.

**Step 2**: Defunct

The image will be marked as *Defunct* once it goes through the
deprecation cycle without any action. At that point, it will be
removed from the Bioconductor organization on Docker Hub.

Example:

  An Image identified for deprecation during Bioconductor release 3.10
/ devel 3.11 would make the following transitions:

  - deprecate in release 3.10
  - deprecate in devel 3.11

** Bioc Release **
  - deprecate in release 3.11 (i.e., no change in release status)
  - defunct in devel 3.12

** Bioc Release **
- defunct in release 3.12
- gone in devel 3.13

** Bioc Release **
- gone in release 3.13

### Reversing End of Life

A deprecated image can be un-deprecated if it is fixed before the next
Bioconductor release. To have an image un-deprecated, please contact
maintainer@bioconductor.org.

<p class="back_to_top">[ <a href="#top">Back to top</a> ]</p>

## Release Cycle and Support

The Release cycle for images will be slightly different

<p class="back_to_top">[ <a href="#top">Back to top</a> ]</p>

## Acknowledgements

Thanks to the [rocker](https://github.com/rocker-org/rocker) project
for providing the R/RStudio Server containers upon which ours are
based.
